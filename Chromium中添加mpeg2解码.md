## Chromium中ffmpeg相关类
### FFmpegDemuxer
Chromium在解析video或audio标签后会创建对应的WebMediaPlayerImpl，如果网络资源不是MediaSource，那么就会创建FFmpegDemuxer，并且保存到demuxer_。再通过Pipeline调用FFmpegDemuxer::Initialize时创建FFmpegGlue，并且开始demux。
### FFmpegGlue
在构造函数中会调用avformat_alloc_context创建avformat，然后在异步调用FFmpegGlue::OpenContext函数开始demux。主要就是调用avformat_open_input让ffmpeg进行demux并返回结果。
### FFmpegDemuxer
FFmpegGlue返回成功demux后，异步调用avformat_find_stream_info找到音视频的信息，并将结果传递给FFmpegDemuxer::OnFindStreamInfoDone，并且为每个AVStream创建对应的FFmpegDemuxerStream。
### FFmpegVideoDecoder
解析出音视频信息后，异步调用WebMediaPlayerImpl::CreateRenderer并通过DefaultRendererFactory创建Renderer，Renderer中包括音频AudioRendererImpl和视频VideoRendererImpl，然后会异步调用RendererImpl::Initialize初始化，并先异步初始化AudioRendererImpl::Initialize，后异步初始化VideoRendererImpl::Initialize，其中会创建并初始化VideoDecoderStream，其中会异步调用DefaultRendererFactory::CreateVideoDecoders来创建多个Decoders，其中最重要的是FFmpegVideoDecoder。
异步调用DecoderStreamTraits<DemuxerStream::VIDEO>::InitializeDecoder中会调用FFmpegVideoDecoder::Initialize来初始化，其中调用FFmpegVideoDecoder::ConfigureDecoder来配置ffmpeg，首先调用avcodec_alloc_context3来创建AVCodecContext，然后调用VideoDecoderConfigToAVCodecContext设置context，然后调用avcodec_find_decoder和avcodec_open2找到并打开AVCodec，最后创建FFmpegDecodingLoop。
### 编码资源数据流
从网络上下载数据后会MultiBufferDataSource，并且通过BlockingUrlProtocol传递给ffmpeg，FFmpegDemuxer从ffmpeg读出AVPacket后，通过FFmpegDemuxerStream转换成DecoderBuffer，再传递给DecoderStream<>，将buffer整合后传递给FFmpegVideoDecoder，这里生成AVPacket传到FFmpegDecodingLoop进行ffmpeg解码。

## Chromium中增加mpeg2
### ffmpeg修改config
修改ffmpeg中的config文件，config_components.h文件中有mpeg2的宏定义，如CONFIG_MPEG2VIDEO_DECODER ，config.h文件中也定义了mpeg2相关的宏定义，如CONFIG_MPEGVIDEO。
### ffmpeg增加编译文件
ffmpeg是模块化的，如果要增加新的解码模块，那么需要将其相关的文件添加到编译目标中，这主要是修改ffmpeg_generated.gni，如libavcodec/mpeg12dec.c等。
### ffmpeg增加解码类
ffmpeg需要将增加的解码类添加到解码列表中，这样就能被找到了，这主要是修改codec_list.c，如ff_mp2_decoder等
### ffmpeg增加解析类
ffmpeg也需要增加解析类到列表中，这主要是修改parser_list.c，如ff_mpegvideo_parser等
### ffmpeg增加新的容器类
如果要增加新的容器类，那么要在解复用列表中添加容器类，这主要是修改demuxer_list.c，同时要在ffmpeg_generated.gni中增加相应的源码文件，如ff_mpegps_demuxer等。